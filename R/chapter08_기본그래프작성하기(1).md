# 난생처음 R 코딩 & 데이터 분석 - Chapter 08. 기본 그래프 작성하기 (1)

데이터가 포함하고 있는 정보를 이해하기 쉽게 표현하는 과정을 **데이터 시각화(Data Visualization)**이라고 한다.  
인간은 숫자보다 이미지로부터 보다 쉽게 정보를 습득하기 때문에 데이터 시각화 기법을 익히는 것은 중요하다.  
데이터 시각화 작업에 기본적으로 사용되는 다양한 그래프 작성 방법에 대해 배워보자. 

---

## 막대그래프를 작성해봅시다

막대그래프는 **그룹이나 범주가 정해져 있는 데이터**를 시각화하는데 사용된다.  

막대그래프는 그룹별로 집계된 데이터를 표현하는 도구이기 때문에,  
막대그래프를 작성하기 위해서는 먼저 *그룹별로 데이터를 집계하는 작업*이 필요하다. 

- 단일변수 자료 : 단일 특성에 대해 데이터를 수집한 것
- 범주형 자료 : 크기를 측정할 수 없는 자료

### 도수분포표 계산하기

`table()` 함수는 벡터에 저장된 범주형 데이터에 대해 데이터 값을 종류별로 집계해주는 함수이다.  
이렇게 도수분포로 **각 데이터의 종류별 빈도**를 파악할 수 있고, 이 내용을 도표로 나타낸 것이 도수분포표이다. 

위에서 `table()` 함수를 이용해 도수분포표를 저장하고, 막대그래프를 작성해주자.   

**`barplot(도수분포표, main="막대그래프 상단의 그래프 title")`**  

그래프에서 x축은 관측값의 종류를 나타내고, y축은 빈도를 나타낸다.  

### 그래프 상세 설정

- 그래프의 색을 지정해줄 수도 있다.  
`col="blue"` 와 같이 col값을 그래프 함수를 만들 때 매개변수로 넣어주면 된다.  
`colors()` 함수를 실행하면 R 그래프에 사용할 수 있는 색의 이름을 알 수 있다. 

- 만약 막대 별로 색을 다르게 지정하고 싶다면,  
`c()`를 이용해서 막대의 개수만큼 색을 지정하면 된다.  
ex) `col=c("Blue", "Orange", "Red", "Green")`

- 일일이 색을 지정하는 게 번거롭다면 팔레트를 이용하는 방법도 있다.  
`rainbow(), heat.colors(), terrain.colors(), topo.colors(), cm.colors()` 등등이 있으며,  
`col=rainbow(4)` 처럼 함수 안에 막대의 갯수를 넣어주면 된다.  

- x축, y축에 이름을 붙여줄 수도 있다.   
`xlab="제목", ylab="제목"` 을 파라미터로 추가해준다.  

- 그래프 막대를 수평 방향으로 출력할 수도 있다.  
그럴 때는 `horiz=TRUE` 값을 파라미터로 넣어준다.  
매개변수 horiz의 기본값은 FALSE 이다. 

- x축의 그룹 이름을 바꿔서 출력하고 싶다면,  
`names=c("이름1", "이름2", "이름3", "이름4")` 로 넣어주면 된다.  

- x축의 그룹 이름이 너무 길다면, 이름끼리 겹치는 경우가 생길 수 있다.  
이럴 때 그룹 이름을 수직방향으로 출력하면 겹치지 않게 나타낼 수 있다.  
매개변수 `las=`를 넣어주면 되는데, las 값을 뭐로 넣어주느냐에 따라 방향 설정을 할 수 있다.  
    - `las=0`: 축 방향 (기본값)
    - `las=1` : 수평 방향 (축 방향과 상관없음)
    - `las=2` : 축을 기준으로 수직 방향
    - `las=3` : 수직 방향 (축 방향과 상관없음)

### 중첩그룹의 막대그래프

데이터 중에는 그룹 안에 또 다른 그룹이 존재하는 경우가 있다.  
예를 들어 20년 간격으로 우리나라의 인구를 추정한 데이터가 있다고 할 때,  
첫번째로는 연도별로 그룹이 나누어져 있고,  
두번째로는 연도 안에서도 연령대별로 그룹이 존재할 수 있다.  

이런 경우 barplot() 기본 함수에 데이터를 넣어주면,  
막대 그래프가 색으로 구분되서 분할된 형태의 그래프가 그려진다.   

분할 된 막대도 색을 다르게 지정할 수 있다.  
`col=` 매개변수 사용이 가능한데,  
색의 순서는 그래프의 막대를 기준으로 아래에서 위쪽 방향으로 순서가 적용된다.  

또한, 하나의 막대를 여러 데이터가 분할하는 형식이 아니라  
각각의 막대로 표현할 수도 있다.  
`beside=TRUE` 매개변수를 넣어주면 된다.  

### 막대그래프에 범례 추가

어느 막대가 어떤 값을 의미하는지 알기 쉽게 도와주는 것이 범례(legend)이다.  
`legend.text=T` 값을 매개변수로 넣어주면 그래프 위에 범례가 표시된다.  
하지만, 실제로 실행해보면 막대그래프와 겹쳐져서 보이지 않는 부분이 생긴다.  

그래서, 범례를 그래프 밖에 표시하도록 설정해줄 수 있다.  
이를 위해서는 범례를 표시할 충분한 공간을 미리 설정해야 한다.  

`par(mfrow=c(1,1), mar=c(5,5,5,7))`  
- **par() 함수는 매개변수가 아니다! 때문에 barplot()함수를 쓰기 전에 따로 다른 라인에 써주어야한다!**
- mfrow값은 그래프를 출력할 창을 어떻게 분할 할 지 지정하는데, c(1,1)은 창을 분할하지 않는 것을 의미한다. 
- mar 값은 css식의 margin과 비슷하다. 그래프를 출력할 창과 그래프 출력 영역 밖의 여유 공간을 지정해주는 건데, c(bottom, left, top, right)의 순서로 숫자를 지정한다.
- 범례를 오른쪽에 출력하기 위해서 오른쪽에 여유 공간을 더 많이 설정해주어야 한다. 
- **par() 함수를 한번 실행시켜주면 R이 실행되는 동안 계속해서 설정값이 유지된다.**  
따라서 그래프 작업을 마무리할 때 원래의 설정값으로 되돌려주는 것이 좋다.  
`par(mfrow=c(1,1), mar=(5,4,4,2)+0.1)`  
해당 코드를 입력해주면 그래프창의 설정이 해제된다. 

`args.legend = list(x="topright", bty="n", inset=c(-0.25,0))`
- x값은 범례를 출력할 기본 위치를 지정하는데, topright은 그래프 출력 영역의 위쪽/오른쪽을 의미한다. 
- bty는 범례가 표시되는 영역에 테두리선을 표시할지의 여부를 지정한다. 'o'는 테두리선을 표시하고, 'n'은 표시하지 않는다. 
- inset은 범례를 x축과 y축의 방향으로 얼마나 이동시킬지를 지정한다. -1 ~ 1 사이의 값을 지정한다.  
*inset에서 x축, y축의 기준은 매개변수 x의 값에 따라 달라진다.*

범례는 데이터의 행 이름으로 표시되는 게 기본값이다.  
만약 바꾸고 싶다면 원하는 내용을 아래와 같이 직접 입력해줄 수 있다.  
`legend.text=c("0~14세", "15~64세","65세 이상")`

---

## 히스토그램을 작성해봅니다

히스토그램은 막대그래프와 외관상 비슷한 그래프로,  
**그룹이 명시적으로 존재하지 않는 수치형 자료의 분포**를 시각화할 때 사용한다.  

막대그래프를 그리려면 -> 값의 종류별로 개수를 셀 수 있어야 하는데,  
키나 몸무게 등의 수치형 자료는 데이터 내에 값의 종류라는 개볌이 없어서 종류별로 개수를 셀 수 없다!  

대신에 수치형 자료에서는 값들의 **구간**을 나누고, **구간에 속하는 값들의 개수를 세는 방법**을 사용한다.  

막대그래프와 히스토그램을 쉽게 구별할 수 있는 방법은,  
일반적으로 막대 사이에 간격이 있으면 막대그래프이고,  
간격이 없이 막대들이 붙어있으면 히스토그램이라고 구분할 수 있다.  
*막대그래프에서는 막대의 면적이 의미가 없지만, 히스토그램에서는 면적이 의미가 있다.*

R에서는 `hist()`함수를 사용해서 히스토그램을 작성한다.  

`hist()` 함수의 매개변수는 대부분 앞에서 배운 `barplot()` 함수에서 배운 것을 동일하게 적용 가능하다.  

추가로 몇가지를 더 배워보면,  
- `border="blue"` : 막대의 테두리 색을 지정한다
- `breaks=5` : 데이터 내의 구간을 몇 개로 나눌지 지정한다.  
    - 값이 커질 수록 막대의 개수도 늘어나며, 우항에 적은 숫자처럼 반드시 막대의 개수가 딱 떨어지지는 않는다.  

### 히스토그램의 자료구조 이해 - 심화

히스토그램과 막대그래프는 변수에 할당할 수 있는데,  
이 경우 변수에 그래프의 이미지가 아니라 그래프를 그리기 위한 정보들이 저장된다.  

막대그래프의 경우, class(막대그래프)를 해보면 결과값이 matrix, array 로 나오는 반면,  
히스토그램의 경우, class(히스토그램)을 해보면 결과값이 histogram 으로 나온다. 

또한 unique(막대그래프)를 해보면 matrix가 출력되고,  
unique(히스토그램)을 해보면 **리스트(list) 형태의 자료가 출력**되는 것을 볼 수 있다!

그렇다면 마지막으로 ls()함수를 적용시켜보았다.  
막대그래프는 에러가 발생하며 ls() 함수가 적용되지 않고,  
히스토그램은 breaks, counts, density, equidist, mids, xname   
이렇게 6개의 변수가 나오는 것을 확인할 수 있다!  

*아마도, 히스토그램은 그래프를 그리기 위해 hist() 함수를 적용했을 때 구간 등을 함수가 알아서 판단해서 결과값을 반환하기 때문에 list 형태로 데이터를 저장해놓는 것이라고 추측해본다.*  

이 중 히스토그램 데이터 내부의 두 가지 변수에 대해서 살펴보자.   

- histogram$breaks : 히스토그램을 작성하기 위한 구간의 경계값들
- histogram$counts : 구간별 빈도수

이 때 주의할 점은, **구간 경계값의 개수가 구간 빈도수보다 개수가 하나 더 많다!!**

## 그래프에 대해 더 알아봅니다

### 다중 그래프

위에서 다뤘던 `par(mfrow=c(2,2), mar=c(3,3,4,2))` 을 이용해서 plot창을 화면 분할 해준다.  
여기서 매개변수 mar는 분할된 화면 각각에 적용된다.  

또한, 화면 분할을 취소하고 싶으면 기본값으로 설정을 돌려놔야한다.  
기본값은 아래와 같다.  
`par(mfrow=c(1,1), mar=c(5,4,4,2)+0.1)`

### 그래프를 파일에 저장

plot창에 나타난 그래프를 워드나 파워포인트 같은 문서 편집 소프트웨어로 옮기는 방법에 대해 알아보자.  

plot 창에 상단에 있는 Zoom 버튼을 누르면 Plot Zoom 팝업창이 나타난다.  
여기서 마우스 오른쪽 버튼을 누르면 Copy Image 혹은 Save Image As 를 선택할 수 있다.  

파일을 저장하려면 확장자를 .png 또는 .jpg로 저장해주자.  

**주의할 점은, Plot Zoom 창에 표시된 크기와 모양 그대로 그래프가 복사되기 때문에 미리 Plot Zoom 팝업창을 조절하여 원하는 그래프의 크기로 만든 다음, 작업을 진행해야 한다.**  

또한, Plot창의 Zoom 버튼 옆에 있는 Export 메뉴를 클릭해도 그래프를 파일로 저장할 수 있다. 


