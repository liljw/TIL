# 난생처음 R 코딩 & 데이터 분석 - Chapter 11. 데이터 전처리 알아보기

현실에서는 잘 정리된 데이터셋을 얻는 경우가 많지 않다.  
그래서, 확보한 데이터를 정제하고 가공해야 비로소 분석에 적합한 데이터를 얻을 수 있게 된다.  
이러한 과정을 **데이터 전처리**(data preprocessing) 이라고 한다. 

## 결측값에 대해 알아봅시다

결측값(NA)이란?  
-> 데이터의 수집, 저장 과정에서 값을 얻지 못하는 경우 발생한다.  

결측값을 처리하는 방법은 아래와 같이 2가지로 나눠볼 수 있다.  

1. 결측값을 제거하거나 제외한 후 분석한다.
2. 결측값을 추정하여 적당한 값으로 치환한 후 분석한다. 

- `is.na()` 함수는 벡터에 결측값이 있는지 확인하는 함수이다.
    - 위 함수의 결과는 TRUE, FALSE, FALSE, FALSE, TRUE... 로 나오는데,  
    TRUE는 1, FALSE는 0이므로, 몇 개의 관측값이 있는지를 알고 싶을 때는  
    `sum(is.na(vector))` 를 써줄 수 있다. (값이 1인 것을 다 더한다)
- `na.rm=TRUE` 매개변수는 결측값을 제외하고 함수를 적용할지 여부를 지정하는 매개변수이다. 

결측값을 다른 값으로 치환하는 방법에는 아래와 같은 코드를 사용할 수 있다.   

`v1[is.na(v1)] <- 0`

위의 코드는 벡터의 인덱싱으로 대괄호 안에 조건문을 넣어주고,  
조건문에 만족하는, TRUE에 해당하는 값들(그 값의 인덱스)에 대해서만 0으로 값을 바꿔준 것을 의미한다.  

결측값을 제거하는데는 `na.omit()` 함수를 쓸 수 있다.  
다만, na.omit 함수로 벡터의 결측값을 제거 할 경우 결과의 자료구조가 벡터가 아니기 때문에  
`as.vector()` 함수를 이용하여 다시 자료구조를 벡터로 만들어줘야한다.  

`rowSums()` 함수는 행별 NA의 개수를 의미한다.  

`complete.cases()` 함수는 어떤 데이터셋에서 NA를 포함하지 않은 완전한(complete)행들의 인덱스를 찾아준다. 사용할 때는 `df[complete.cases(df),]` 이런식으로 써준다. 

---

## 이것이 정렬입니다

정렬(sort)은 주어진 기준에 따라 데이터를 크기순으로 재배열하는 과정이다.   
숫자의 경우는 숫자의 크기에 따라 정렬이 가능하고, 문자열의 경우는 알파벳순, 또는 가나다순으로 정렬이 가능하다.  

`sort(v1)` 함수를 이용해서 정렬이 가능하며,  
내림차순 정렬의 경우 매개변수 `decreasing=T`를 이용해준다.  

*sort 함수의 경우 NA가 포함된 벡터를 정렬하면 오름차순이나 내림차순 지정에 상관없이 NA값들은 맨 뒤쪽에 위치시킨다.*  

비슷한 함수로 `order()` 함수가 있는데,  
sort 함수는 값의 크기에 따라 값들을 정렬하는 함수였다면,  
order 함수는 값의 크기에 따라 값들의 **인덱스**를 정렬하는 함수이다.  

order 함수는 **특정 열을 기준으로 데이터셋을 정렬하고 싶을 때** 사용하는 함수이다!  
ex) `df[order(df$vector, decreasing=T),]`

---

## 샘플링과 조합이란 무엇인가요?

샘플링(sampling)은 주어진 값들이 있을 때 그 중에서 임의의 개수만큼 값들을 추출하는 작업을 뜻한다.  
그 중 중복을 허용하는 것을 **복원 추출**,  
중복을 허용하지 않는 것을 **비복원 추출**이라고 한다.  

`sample()` 함수를 이용해서 샘플링을 할 수 있다. 
- 첫번째 매개변수로는 값을 추출해 올 데이터셋을 넣어준다. 
- 두번째 매개변수로는 `size=` 매개변수를 넣어주는데, 추출할 값의 개수를 의미한다. 
- 세번째 매개변수로는 `replace=` 매개변수를 이용해 복원 / 비복원 추출의 여부를 넣어준다.  
복원 추출의 경우 replace=T 를, 비복원 추출의 경우는 replace=F를 넣어준다. 

샘플링은 샘플을 무작위로 추출하는 것이기 때문에 매번 반환되는 값이 다르다.  
만약, 값을 고정해주고 싶다면 `set.seed()` 함수를 이용하자.  
set.seed 함수 내의 매개변수 값이 같으면 sample 함수의 결과도 같다. 

---

### 조합

조합(combination)은 글자 그대로 주어진 데이터값 중에서 몇 개씩 짝을 지어 추출하는 작업을 말한다.  

`combn()` 함수를 사용해서 조합을 뽑을 수 있다. 
- 첫번째 매개변수에는 벡터를 입력해준다.
- 두번째 매개변수로는 몇 개씩 뽑을지 개수를 넣어준다.

combn 함수의 실행 결과는 하나의 **열**이 하나의 조합을 나타낸다.  

---

## 데이터를 집계해봅시다

매트릭스나 데이터프레임 같은 2차원 데이터에서,  
데이터의 그룹에 대해서 합계나 평균을 계산할 때는 집계(aggregation)함수를 써주면 된다.  

`aggregate(df, by=list(df$vector), FUN=function)` 

- 첫번째 매개변수로는 데이터 셋을 넣어준다.
    - **함수(연산)를 적용시킬 수 없는 열은 반드시 제외하고 넣어주어야 한다!**
- 두번째 매개변수로는 어떤 그룹을 기준으로 할 건지 list의 형식으로 넣어준다. 
    - 만약 집계 기준이 되는 열 이름을 default 값인 Group.1이 아니라, 원하는 걸로 지정해주고 싶다면  
    `by=list(사용자지정번수명=vector)`의 형식으로 수정해준다.
- 세번째 매개변수로는 어떤 함수를 적용시킬 건지 적어준다.

기준은 하나만 가능한 것이 아니라 2개 이상도 가능하다!!



